const nodemailer = require('nodemailer');
const transporter = nodemailer.createTransport({
  host: 'smtp.gmail.com',
  port: 587,
  secure: false,
  auth: {
    user: process.env.EMAIL_USER || 'your-email@gmail.com',
    pass: process.env.EMAIL_PASSWORD || 'your-app-password'
  },
  tls: {
    rejectUnauthorized: false
  }
});
const emailTemplates = {
  en: {
    subject: 'Your FIR Draft - Legal Lens',
    body: `Dear User,

Please find attached your First Information Report (FIR) draft generated by Legal Lens.

This is a computer-generated draft. Please review all details carefully before submitting to authorities.

Important Instructions:
1. Review the FIR details thoroughly
2. Make any necessary corrections
3. Print and sign the document
4. Submit to your nearest police station

For any questions or support, please contact your local women's safety helpline or legal aid service.

Stay safe,
Legal Lens Team`
  },
  hi: {
    subject: 'рдЖрдкрдХрд╛ FIR рдкреНрд░рд╛рд░реВрдк - рд▓реАрдЧрд▓ рд▓реЗрдВрд╕',
    body: `рдкреНрд░рд┐рдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛,

рдХреГрдкрдпрд╛ рд▓реАрдЧрд▓ рд▓реЗрдВрд╕ рджреНрд╡рд╛рд░рд╛ рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдЖрдкрдХрд╛ рдкреНрд░рдердо рд╕реВрдЪрдирд╛ рд░рд┐рдкреЛрд░реНрдЯ (FIR) рдкреНрд░рд╛рд░реВрдк рд╕рдВрд▓рдЧреНрди рдкрд╛рдПрдВред

рдпрд╣ рдПрдХ рдХрдВрдкреНрдпреВрдЯрд░-рдЬрдирд┐рдд рдкреНрд░рд╛рд░реВрдк рд╣реИред рдХреГрдкрдпрд╛ рдЕрдзрд┐рдХрд╛рд░рд┐рдпреЛрдВ рдХреЛ рдЬрдорд╛ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рд╕рднреА рд╡рд┐рд╡рд░рдгреЛрдВ рдХреА рд╕рд╛рд╡рдзрд╛рдиреАрдкреВрд░реНрд╡рдХ рд╕рдореАрдХреНрд╖рд╛ рдХрд░реЗрдВред

рдорд╣рддреНрд╡рдкреВрд░реНрдг рдирд┐рд░реНрджреЗрд╢:
1. FIR рд╡рд┐рд╡рд░рдг рдХреА рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕рдореАрдХреНрд╖рд╛ рдХрд░реЗрдВ
2. рдЖрд╡рд╢реНрдпрдХ рд╕реБрдзрд╛рд░ рдХрд░реЗрдВ
3. рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреЛ рдкреНрд░рд┐рдВрдЯ рдХрд░реЗрдВ рдФрд░ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХрд░реЗрдВ
4. рдЕрдкрдиреЗ рдирд┐рдХрдЯрддрдо рдкреБрд▓рд┐рд╕ рд╕реНрдЯреЗрд╢рди рдореЗрдВ рдЬрдорд╛ рдХрд░реЗрдВ

рдХрд┐рд╕реА рднреА рдкреНрд░рд╢реНрди рдпрд╛ рд╕рд╣рд╛рдпрддрд╛ рдХреЗ рд▓рд┐рдП, рдХреГрдкрдпрд╛ рдЕрдкрдиреА рд╕реНрдерд╛рдиреАрдп рдорд╣рд┐рд▓рд╛ рд╕реБрд░рдХреНрд╖рд╛ рд╣реЗрд▓реНрдкрд▓рд╛рдЗрди рдпрд╛ рдХрд╛рдиреВрдиреА рд╕рд╣рд╛рдпрддрд╛ рд╕реЗрд╡рд╛ рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдВред

рд╕реБрд░рдХреНрд╖рд┐рдд рд░рд╣реЗрдВ,
рд▓реАрдЧрд▓ рд▓реЗрдВрд╕ рдЯреАрдо`
  },
  te: {
    subject: 'р░ор▒А FIR р░бр▒Нр░░р░╛р░лр▒Нр░Яр▒Н - р░▓р▒Ар░Чр░▓р▒Н р░▓р▒Жр░ир▒Нр░╕р▒Н',
    body: `р░кр▒Нр░░р░┐р░п р░╡р░┐р░ир░┐р░пр▒Лр░Чр░жр░╛р░░р▒Б,

р░▓р▒Ар░Чр░▓р▒Н р░▓р▒Жр░ир▒Нр░╕р▒Н р░жр▒Нр░╡р░╛р░░р░╛ р░░р▒Вр░кр▒Кр░Вр░жр░┐р░Вр░Ър░мр░бр░┐р░и р░ор▒А р░лр░╕р▒Нр░Яр▒Н р░Зр░ир▒Нр░лр░░р▒Нр░ор▒Зр░╖р░ир▒Н р░░р░┐р░кр▒Лр░░р▒Нр░Яр▒Н (FIR) р░бр▒Нр░░р░╛р░лр▒Нр░Яр▒Н р░жр░пр░Ър▒Зр░╕р░┐ р░Ьр░д р░Ър▒Вр░бр░Вр░бр░┐.

р░Зр░жр░┐ р░Хр░Вр░кр▒Нр░пр▒Вр░Яр░░р▒Н р░░р▒Вр░кр▒Кр░Вр░жр░┐р░Вр░Ър░┐р░и р░бр▒Нр░░р░╛р░лр▒Нр░Яр▒Н. р░Ер░зр░┐р░Хр░╛р░░р▒Бр░▓р░Хр▒Б р░╕р░ор░░р▒Нр░кр░┐р░Вр░Ър▒З р░ор▒Бр░Вр░жр▒Б р░Ер░ир▒Нр░ир░┐ р░╡р░┐р░╡р░░р░╛р░▓р░ир▒Б р░Ьр░╛р░Чр▒Нр░░р░др▒Нр░др░Чр░╛ р░╕р░ор▒Ар░Хр▒Нр░╖р░┐р░Вр░Ър░Вр░бр░┐.

р░ор▒Бр░Цр▒Нр░пр░ор▒Ир░и р░╕р▒Вр░Ър░ир░▓р▒Б:
1. FIR р░╡р░┐р░╡р░░р░╛р░▓р░ир▒Б р░Хр▒Нр░╖р▒Бр░гр▒Нр░гр░Вр░Чр░╛ р░╕р░ор▒Ар░Хр▒Нр░╖р░┐р░Вр░Ър░Вр░бр░┐
2. р░Ер░╡р░╕р░░р░ор▒Ир░и р░жр░┐р░жр▒Нр░жр▒Бр░мр░╛р░Яр▒Нр░▓р▒Б р░Ър▒Зр░пр░Вр░бр░┐
3. р░кр░др▒Нр░░р░╛р░ир▒Нр░ир░┐ р░кр▒Нр░░р░┐р░Вр░Яр▒Н р░Ър▒Зр░╕р░┐ р░╕р░Вр░др░Хр░В р░Ър▒Зр░пр░Вр░бр░┐
4. р░ор▒А р░╕р░ор▒Ар░кр░Вр░▓р▒Лр░ир░┐ р░кр▒Лр░▓р▒Ар░╕р▒Н р░╕р▒Нр░Яр▒Зр░╖р░ир▒НтАМр░Хр▒Б р░╕р░ор░░р▒Нр░кр░┐р░Вр░Ър░Вр░бр░┐

р░Пр░╡р▒Ир░ир░╛ р░кр▒Нр░░р░╢р▒Нр░ир░▓р▒Б р░▓р▒Зр░жр░╛ р░ор░жр▒Нр░жр░др▒Б р░Хр▒Лр░╕р░В, р░жр░пр░Ър▒Зр░╕р░┐ р░ор▒А р░╕р▒Нр░ер░╛р░ир░┐р░Х р░ор░╣р░┐р░│р░╛ р░нр░жр▒Нр░░р░др░╛ р░╣р▒Жр░▓р▒Нр░кр▒НтАМр░▓р▒Ир░ир▒Н р░▓р▒Зр░жр░╛ р░ир▒Нр░пр░╛р░п р░╕р░╣р░╛р░п р░╕р▒Зр░╡р░ир▒Б р░╕р░Вр░кр▒Нр░░р░жр░┐р░Вр░Ър░Вр░бр░┐.

р░╕р▒Бр░░р░Хр▒Нр░╖р░┐р░др░Вр░Чр░╛ р░Йр░Вр░бр░Вр░бр░┐,
р░▓р▒Ар░Чр░▓р▒Н р░▓р▒Жр░ир▒Нр░╕р▒Н р░мр▒Гр░Вр░жр░В`
  },
  ta: {
    subject: 'роЙроЩрпНроХро│рпН FIR ро╡ро░рпИро╡рпБ - ро▓рпАроХро▓рпН ро▓рпЖройрпНро╕рпН',
    body: `роЕройрпНрокрпБро│рпНро│ рокропройро░рпН,

ро▓рпАроХро▓рпН ро▓рпЖройрпНро╕ро╛ро▓рпН роЙро░рпБро╡ро╛роХрпНроХрокрпНрокроЯрпНроЯ роЙроЩрпНроХро│рпН роорпБродро▓рпН родроХро╡ро▓рпН роЕро▒ро┐роХрпНроХрпИ (FIR) ро╡ро░рпИро╡рпБ роЗрогрпИроХрпНроХрокрпНрокроЯрпНроЯрпБро│рпНро│родрпБ.

роЗродрпБ роХрогро┐ройро┐ропро╛ро▓рпН роЙро░рпБро╡ро╛роХрпНроХрокрпНрокроЯрпНроЯ ро╡ро░рпИро╡рпБ. роЕродро┐роХро╛ро░ро┐роХро│рпБроХрпНроХрпБ роЪрооро░рпНрокрпНрокро┐роХрпНроХрпБроорпН роорпБройрпН роЕройрпИродрпНродрпБ ро╡ро┐ро╡ро░роЩрпНроХро│рпИропрпБроорпН роХро╡ройрооро╛роХ роородро┐рокрпНрокро╛ропрпНро╡рпБ роЪрпЖропрпНропро╡рпБроорпН.

роорпБроХрпНроХро┐роп ро╡ро┤ро┐роорпБро▒рпИроХро│рпН:
1. FIR ро╡ро┐ро╡ро░роЩрпНроХро│рпИ роорпБро┤рпБроорпИропро╛роХ роородро┐рокрпНрокро╛ропрпНро╡рпБ роЪрпЖропрпНропро╡рпБроорпН
2. родрпЗро╡рпИропро╛рой родро┐ро░рпБродрпНродроЩрпНроХро│рпИроЪрпН роЪрпЖропрпНропро╡рпБроорпН
3. роЖро╡рогродрпНродрпИ роЕроЪрпНроЪро┐роЯрпНроЯрпБ роХрпИропрпКрокрпНрокрооро┐роЯро╡рпБроорпН
4. роЙроЩрпНроХро│рпН роЕро░рпБроХро┐ро▓рпБро│рпНро│ роХро╛ро╡ро▓рпН роиро┐ро▓рпИропродрпНродро┐ро▓рпН роЪрооро░рпНрокрпНрокро┐роХрпНроХро╡рпБроорпН

роПродрпЗройрпБроорпН роХрпЗро│рпНро╡ро┐роХро│рпН роЕро▓рпНро▓родрпБ роЙродро╡ро┐роХрпНроХрпБ, родропро╡рпБроЪрпЖропрпНродрпБ роЙроЩрпНроХро│рпН роЙро│рпНро│рпВро░рпН рокрпЖрогрпНроХро│рпН рокро╛родрпБроХро╛рокрпНрокрпБ ро╣рпЖро▓рпНрокрпНро▓рпИройрпН роЕро▓рпНро▓родрпБ роЪроЯрпНроЯ роЙродро╡ро┐ роЪрпЗро╡рпИропрпИродрпН родрпКроЯро░рпНрокрпБ роХрпКро│рпНро│ро╡рпБроорпН.

рокро╛родрпБроХро╛рокрпНрокро╛роХ роЗро░рпБроЩрпНроХро│рпН,
ро▓рпАроХро▓рпН ро▓рпЖройрпНро╕рпН роХрпБро┤рпБ`
  },
  bn: {
    subject: 'ржЖржкржирж╛рж░ FIR ржЦрж╕ржбрж╝рж╛ - рж▓рж┐ржЧрзНржпрж╛рж▓ рж▓рзЗржирзНрж╕',
    body: `ржкрзНрж░рж┐ржпрж╝ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА,

рж▓рж┐ржЧрзНржпрж╛рж▓ рж▓рзЗржирзНрж╕ ржжрзНржмрж╛рж░рж╛ рждрзИрж░рж┐ ржЖржкржирж╛рж░ ржкрзНрж░ржержо рждржерзНржп рж░рж┐ржкрзЛрж░рзНржЯ (FIR) ржЦрж╕ржбрж╝рж╛ рж╕ржВржпрзБржХрзНржд ржХрж░рзБржиред

ржПржЯрж┐ ржПржХржЯрж┐ ржХржорзНржкрж┐ржЙржЯрж╛рж░-ржЙрзОржкржирзНржи ржЦрж╕ржбрж╝рж╛ред ржХрж░рзНрждрзГржкржХрзНрж╖рзЗрж░ ржХрж╛ржЫрзЗ ржЬржорж╛ ржжрзЗржУржпрж╝рж╛рж░ ржЖржЧрзЗ рж╕ржорж╕рзНржд ржмрж┐ржмрж░ржг рж╕рж╛ржмржзрж╛ржирзЗ ржкрж░рзНржпрж╛рж▓рзЛржЪржирж╛ ржХрж░рзБржиред

ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржирж┐рж░рзНржжрзЗрж╢рж╛ржмрж▓рзА:
1. FIR ржмрж┐ржмрж░ржг ржкрзБржЩрзНржЦрж╛ржирзБржкрзБржЩрзНржЦржнрж╛ржмрзЗ ржкрж░рзНржпрж╛рж▓рзЛржЪржирж╛ ржХрж░рзБржи
2. ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ рж╕ржВрж╢рзЛржзржи ржХрж░рзБржи
3. ржиржерж┐ржЯрж┐ ржорзБржжрзНрж░ржг ржХрж░рзБржи ржПржмржВ рж╕рзНржмрж╛ржХрзНрж╖рж░ ржХрж░рзБржи
4. ржЖржкржирж╛рж░ ржирж┐ржХржЯрждржо ржкрзБрж▓рж┐рж╢ рж╕рзНржЯрзЗрж╢ржирзЗ ржЬржорж╛ ржжрж┐ржи

ржпрзЗржХрзЛржирзЛ ржкрзНрж░рж╢рзНржи ржмрж╛ рж╕рж╣рж╛ржпрж╝рждрж╛рж░ ржЬржирзНржп, ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ ржЖржкржирж╛рж░ рж╕рзНржерж╛ржирзАржпрж╝ ржорж╣рж┐рж▓рж╛ рж╕рзБрж░ржХрзНрж╖рж╛ рж╣рзЗрж▓рзНржкрж▓рж╛ржЗржи ржмрж╛ ржЖржЗржирж┐ рж╕рж╣рж╛ржпрж╝рждрж╛ ржкрж░рж┐рж╖рзЗржмрж╛рж░ рж╕рж╛ржерзЗ ржпрзЛржЧрж╛ржпрзЛржЧ ржХрж░рзБржиред

ржирж┐рж░рж╛ржкржж ржерж╛ржХрзБржи,
рж▓рж┐ржЧрзНржпрж╛рж▓ рж▓рзЗржирзНрж╕ ржЯрж┐ржо`
  }
};

const defaultTemplate = emailTemplates.en;

async function sendFIREmail(recipientEmail, firPDFPath, language = 'en') {
  try {
    const template = emailTemplates[language] || defaultTemplate;

    const mailOptions = {
      from: process.env.EMAIL_USER || 'Legal Lens <your-email@gmail.com>',
      to: recipientEmail,
      subject: template.subject,
      text: template.body,
      html: `
        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px;">
          <div style="background: white; padding: 30px; border-radius: 10px;">
            <h2 style="color: #667eea; margin-bottom: 20px;">ЁЯЫбя╕П Legal Lens - FIR Draft</h2>
            <pre style="white-space: pre-wrap; font-family: Arial, sans-serif; line-height: 1.6;">${template.body}</pre>
            <hr style="border: none; border-top: 2px solid #eee; margin: 30px 0;">
            <p style="color: #666; font-size: 12px; text-align: center;">
              This is an automated email from Legal Lens. Please do not reply to this email.
            </p>
          </div>
        </div>
      `,
      attachments: [
        {
          filename: `FIR_Draft_${Date.now()}.pdf`,
          path: firPDFPath
        }
      ]
    };

    const info = await transporter.sendMail(mailOptions);
    
    return {
      success: true,
      messageId: info.messageId,
      message: `Email sent successfully to ${recipientEmail}`
    };
  } catch (error) {
    console.error('Email sending error:', error);
    return {
      success: false,
      error: error.message
    };
  }
}
async function verifyEmailConfig() {
  try {
    await transporter.verify();
    console.log('тЬЕ Email service is ready');
    return true;
  } catch (error) {
    console.error('тЭМ Email service error:', error.message);
    console.log('\nTo configure email service:');
    console.log('1. Use Gmail and enable 2-Step Verification');
    console.log('2. Generate an App Password: https://myaccount.google.com/apppasswords');
    console.log('3. Set environment variables:');
    console.log('   EMAIL_USER=your-email@gmail.com');
    console.log('   EMAIL_PASSWORD=your-16-char-app-password');
    return false;
  }
}

module.exports = {
  sendFIREmail,
  verifyEmailConfig
};
